1.Причесать код
2.Добавить проверку на то, чтобы не было >2 одинаковых направлений подряд